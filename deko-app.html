<link rel="import" href="da-elements.html">
<link rel="import" href="../fab-menu/fab-menu.html">
<link rel="import" href="../app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html">
<link rel="import" href="../polymerfire/polymerfire.html">
<dom-module id="deko-app">
  <template>
    <style include="deko-app-shared-styles"></style>
    <da-toolbar signed-in="[[signedIn]]" on-sign-out="signOut"></da-toolbar>
    <da-login on-sign-in="signIn" signed-in="[[signedIn]]" disabled="[[!online]]"></da-login>
    <firebase-auth id="auth" app-name="decks" provider="google" signed-in="{{signedIn}}" user="{{user}}"></firebase-auth>
    <firebase-query id="query" app-name="decks" path="/decks" data="{{data}}"></firebase-query>
    <app-indexeddb-mirror session="[[user.uid]]" key="decks" data="{{data}}" persisted-data="{{persistedData}}"></app-indexeddb-mirror>
    <div class="decks">
      <template is="dom-repeat" items="[[persistedData]]" as="deck">
        <da-deck id$="[[deck.$key]]" title="[[deck.title]]" body="[[deck.body]]" on-tap="edit"></da-deck>
      </template>
    </div>
    <fab-menu disabled="[[!online]]" label="Add / Edit" on-delete="fabDelete" on-add="create" on-edit="fabEdit" icon="touch-app" back-label="Cancel" back-icon="subdirectory-arrow-left" menu="{{menu}}"></fab-menu>
    <firebase-document id="document" app-name="decks" path="[[editableDeckId]]" data="{{editableDeck}}"></firebase-document>
    <da-editor id="editor" deck="{{editableDeck}}" on-close="commitChange" uid="{{user.uid}}"></da-editor>
  </template>
</dom-module>
<script>
  (() => {
    'use strict';
      Polymer({
        is: 'deko-app',
          behaviors: [
          Polymer.DekoAppBehavior
        ],
        properties: {
          menu:{ 
            value: [
              {label:"Edit",icon:"create",fire:{type:"edit"}},
              {label:"Add", icon:"add",   fire:{type:"add"} }
            ],
            type: Array
          }
        },
        fabEdit: function(e){
          console.log("edit")
        },
        get isEditable() {
          return this.online
        },
        get decksPath() {
          return '/decks'
        },
        toEditableId: function(deckId) {
          return this.decksPath +'/'+ deckId
        },
        signIn: function() {
          this.$.auth.signInWithPopup()
        }
      });
    })();
  </script>
